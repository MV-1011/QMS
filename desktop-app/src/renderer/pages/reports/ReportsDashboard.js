import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useEffect } from 'react';
import { apiService } from '../../services/api';
import styles from './ReportsDashboard.module.css';
const ReportsDashboard = () => {
    const [stats, setStats] = useState(null);
    const [compliance, setCompliance] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    useEffect(() => {
        fetchData();
    }, []);
    const fetchData = async () => {
        try {
            setLoading(true);
            const [statsResponse, complianceResponse] = await Promise.all([
                apiService.getDashboardStats(),
                apiService.getComplianceSummary(),
            ]);
            setStats(statsResponse.data);
            setCompliance(complianceResponse.data);
        }
        catch (err) {
            setError(err.message || 'Failed to fetch report data');
        }
        finally {
            setLoading(false);
        }
    };
    const getScoreColor = (score) => {
        if (score >= 80)
            return '#27ae60';
        if (score >= 60)
            return '#f39c12';
        return '#e74c3c';
    };
    if (loading)
        return _jsx("div", { className: styles.loading, children: "Loading reports..." });
    if (error)
        return _jsx("div", { className: styles.error, children: error });
    if (!stats || !compliance)
        return _jsx("div", { className: styles.error, children: "No data available" });
    return (_jsxs("div", { className: styles.container, children: [_jsxs("header", { className: styles.header, children: [_jsx("h1", { children: "Reports & Analytics" }), _jsx("button", { className: styles.refreshBtn, onClick: fetchData, children: "Refresh Data" })] }), _jsxs("section", { className: styles.complianceSection, children: [_jsx("h2", { children: "Compliance Overview" }), _jsxs("div", { className: styles.scoreCard, children: [_jsxs("div", { className: styles.mainScore, style: { borderColor: getScoreColor(compliance.overallScore) }, children: [_jsxs("span", { className: styles.scoreValue, style: { color: getScoreColor(compliance.overallScore) }, children: [compliance.overallScore, "%"] }), _jsx("span", { className: styles.scoreLabel, children: "Overall Compliance Score" })] }), _jsxs("div", { className: styles.metricsGrid, children: [_jsxs("div", { className: styles.metricCard, children: [_jsxs("div", { className: styles.metricHeader, children: [_jsx("span", { children: "Deviation Closure" }), _jsxs("span", { style: { color: getScoreColor(compliance.metrics.deviations.rate) }, children: [compliance.metrics.deviations.rate, "%"] })] }), _jsx("div", { className: styles.progressBar, children: _jsx("div", { className: styles.progressFill, style: { width: `${compliance.metrics.deviations.rate}%`, backgroundColor: getScoreColor(compliance.metrics.deviations.rate) } }) }), _jsxs("span", { className: styles.metricDetail, children: [compliance.metrics.deviations.closed, " / ", compliance.metrics.deviations.total, " closed"] })] }), _jsxs("div", { className: styles.metricCard, children: [_jsxs("div", { className: styles.metricHeader, children: [_jsx("span", { children: "CAPA Closure" }), _jsxs("span", { style: { color: getScoreColor(compliance.metrics.capas.rate) }, children: [compliance.metrics.capas.rate, "%"] })] }), _jsx("div", { className: styles.progressBar, children: _jsx("div", { className: styles.progressFill, style: { width: `${compliance.metrics.capas.rate}%`, backgroundColor: getScoreColor(compliance.metrics.capas.rate) } }) }), _jsxs("span", { className: styles.metricDetail, children: [compliance.metrics.capas.closed, " / ", compliance.metrics.capas.total, " closed"] })] }), _jsxs("div", { className: styles.metricCard, children: [_jsxs("div", { className: styles.metricHeader, children: [_jsx("span", { children: "Training Completion" }), _jsxs("span", { style: { color: getScoreColor(compliance.metrics.trainings.rate) }, children: [compliance.metrics.trainings.rate, "%"] })] }), _jsx("div", { className: styles.progressBar, children: _jsx("div", { className: styles.progressFill, style: { width: `${compliance.metrics.trainings.rate}%`, backgroundColor: getScoreColor(compliance.metrics.trainings.rate) } }) }), _jsxs("span", { className: styles.metricDetail, children: [compliance.metrics.trainings.completed, " / ", compliance.metrics.trainings.total, " completed"] })] }), _jsxs("div", { className: styles.metricCard, children: [_jsxs("div", { className: styles.metricHeader, children: [_jsx("span", { children: "Audit Completion" }), _jsxs("span", { style: { color: getScoreColor(compliance.metrics.audits.rate) }, children: [compliance.metrics.audits.rate, "%"] })] }), _jsx("div", { className: styles.progressBar, children: _jsx("div", { className: styles.progressFill, style: { width: `${compliance.metrics.audits.rate}%`, backgroundColor: getScoreColor(compliance.metrics.audits.rate) } }) }), _jsxs("span", { className: styles.metricDetail, children: [compliance.metrics.audits.completed, " / ", compliance.metrics.audits.total, " completed"] })] })] })] })] }), _jsxs("section", { className: styles.alertsSection, children: [_jsx("h2", { children: "Action Items" }), _jsxs("div", { className: styles.alertsGrid, children: [_jsxs("div", { className: `${styles.alertCard} ${stats.alerts.openDeviations > 0 ? styles.alertWarning : styles.alertSuccess}`, children: [_jsx("span", { className: styles.alertCount, children: stats.alerts.openDeviations }), _jsx("span", { className: styles.alertLabel, children: "Open Deviations" })] }), _jsxs("div", { className: `${styles.alertCard} ${stats.alerts.openCAPAs > 0 ? styles.alertWarning : styles.alertSuccess}`, children: [_jsx("span", { className: styles.alertCount, children: stats.alerts.openCAPAs }), _jsx("span", { className: styles.alertLabel, children: "Open CAPAs" })] }), _jsxs("div", { className: `${styles.alertCard} ${stats.alerts.overdueTrainings > 0 ? styles.alertDanger : styles.alertSuccess}`, children: [_jsx("span", { className: styles.alertCount, children: stats.alerts.overdueTrainings }), _jsx("span", { className: styles.alertLabel, children: "Overdue Trainings" })] }), _jsxs("div", { className: `${styles.alertCard} ${styles.alertInfo}`, children: [_jsx("span", { className: styles.alertCount, children: stats.alerts.upcomingAudits }), _jsx("span", { className: styles.alertLabel, children: "Upcoming Audits (30 days)" })] })] })] }), _jsxs("section", { className: styles.summarySection, children: [_jsx("h2", { children: "Module Summary" }), _jsxs("div", { className: styles.summaryGrid, children: [_jsxs("div", { className: styles.summaryCard, children: [_jsx("div", { className: styles.summaryIcon, children: "\uD83D\uDCC4" }), _jsxs("div", { className: styles.summaryInfo, children: [_jsx("span", { className: styles.summaryCount, children: stats.totals.documents }), _jsx("span", { className: styles.summaryLabel, children: "Documents" })] }), _jsx("div", { className: styles.statusBreakdown, children: stats.byStatus.documents.map((s) => (_jsxs("span", { className: styles.statusItem, children: [s._id, ": ", s.count] }, s._id))) })] }), _jsxs("div", { className: styles.summaryCard, children: [_jsx("div", { className: styles.summaryIcon, children: "\uD83D\uDD04" }), _jsxs("div", { className: styles.summaryInfo, children: [_jsx("span", { className: styles.summaryCount, children: stats.totals.changeControls }), _jsx("span", { className: styles.summaryLabel, children: "Change Controls" })] }), _jsx("div", { className: styles.statusBreakdown, children: stats.byStatus.changeControls.map((s) => (_jsxs("span", { className: styles.statusItem, children: [s._id, ": ", s.count] }, s._id))) })] }), _jsxs("div", { className: styles.summaryCard, children: [_jsx("div", { className: styles.summaryIcon, children: "\u26A0\uFE0F" }), _jsxs("div", { className: styles.summaryInfo, children: [_jsx("span", { className: styles.summaryCount, children: stats.totals.deviations }), _jsx("span", { className: styles.summaryLabel, children: "Deviations" })] }), _jsx("div", { className: styles.statusBreakdown, children: stats.byStatus.deviations.map((s) => (_jsxs("span", { className: styles.statusItem, children: [s._id, ": ", s.count] }, s._id))) })] }), _jsxs("div", { className: styles.summaryCard, children: [_jsx("div", { className: styles.summaryIcon, children: "\uD83D\uDD27" }), _jsxs("div", { className: styles.summaryInfo, children: [_jsx("span", { className: styles.summaryCount, children: stats.totals.capas }), _jsx("span", { className: styles.summaryLabel, children: "CAPAs" })] }), _jsx("div", { className: styles.statusBreakdown, children: stats.byStatus.capas.map((s) => (_jsxs("span", { className: styles.statusItem, children: [s._id, ": ", s.count] }, s._id))) })] }), _jsxs("div", { className: styles.summaryCard, children: [_jsx("div", { className: styles.summaryIcon, children: "\uD83D\uDD0D" }), _jsxs("div", { className: styles.summaryInfo, children: [_jsx("span", { className: styles.summaryCount, children: stats.totals.audits }), _jsx("span", { className: styles.summaryLabel, children: "Audits" })] }), _jsx("div", { className: styles.statusBreakdown, children: stats.byStatus.audits.map((s) => (_jsxs("span", { className: styles.statusItem, children: [s._id, ": ", s.count] }, s._id))) })] }), _jsxs("div", { className: styles.summaryCard, children: [_jsx("div", { className: styles.summaryIcon, children: "\uD83D\uDCDA" }), _jsxs("div", { className: styles.summaryInfo, children: [_jsx("span", { className: styles.summaryCount, children: stats.totals.trainings }), _jsx("span", { className: styles.summaryLabel, children: "Trainings" })] }), _jsx("div", { className: styles.statusBreakdown, children: stats.byStatus.trainings.map((s) => (_jsxs("span", { className: styles.statusItem, children: [s._id, ": ", s.count] }, s._id))) })] })] })] })] }));
};
export default ReportsDashboard;
